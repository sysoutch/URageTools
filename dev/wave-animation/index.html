<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Studio - Glow Edition</title>
    <style>
        :root { --primary: #ff4e50; --bg: #050505; --panel: #111111; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .controls {
            width: 320px;
            background: var(--panel);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-right: 1px solid #222;
            overflow-y: auto;
            z-index: 100;
        }

        h2 { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #222; padding-bottom: 5px; margin-top: 10px; }
        .control-group { display: flex; flex-direction: column; gap: 4px; }
        label { font-size: 11px; color: #555; display: flex; justify-content: space-between; font-weight: bold; }
        
        select, input[type="range"] {
            width: 100%; background: #1a1a1a; border: 1px solid #333; color: white; padding: 6px; border-radius: 4px;
        }

        /* Color Management */
        #color-stack { display: flex; flex-direction: column; gap: 6px; margin-top: 5px; }
        .color-item { display: flex; gap: 6px; align-items: center; background: #000; padding: 4px; border-radius: 4px; border: 1px solid #222; }
        input[type="color"] { border: none; width: 30px; height: 24px; background: none; cursor: pointer; }
        .btn-remove { background: #331111; color: #ff5555; border: none; padding: 2px 6px; cursor: pointer; border-radius: 3px; font-size: 9px; }
        .btn-add { background: #113311; color: #55ff55; border: 1px solid #224422; padding: 8px; cursor: pointer; border-radius: 4px; font-size: 11px; margin-top: 5px; font-weight: bold; }

        #viewport { flex-grow: 1; position: relative; background: #000; overflow: hidden; }
        @keyframes lavaFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: crosshair; }

        .ripple {
            position: absolute; border-radius: 50%; transform: scale(0);
            animation: rippleEffect 1s ease-out; pointer-events: none;
            border: 2px solid var(--primary); z-index: 5;
        }
        @keyframes rippleEffect { 0% { transform: scale(0); opacity: 0.8; } 100% { transform: scale(4); opacity: 0; } }

        #code-output {
            background: #080808; padding: 10px; font-size: 10px; color: #44ff44;
            border-radius: 6px; border: 1px solid #222; white-space: pre-wrap; margin-top: 10px; font-family: monospace;
        }
    </style>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>

    <aside class="controls">
        <h1 style="font-size: 1rem; color: var(--primary);">STUDIO GLOW</h1>
        
        <div class="control-group">
            <label>Master Engine</label>
            <select id="engineMode">
                <option value="waves">Wave Physics</option>
                <option value="particles">Particle Grid</option>
            </select>
        </div>

        <h2>Presets</h2>
        <div class="control-group">
            <select id="presetSelect">
                <option value="lava">Volcanic Lava</option>
                <option value="ocean">Deep Ocean</option>
                <option value="cyber">Cyberpunk Neon</option>
                <option value="custom">-- Custom --</option>
            </select>
        </div>

        <h2>Active Colors</h2>
        <div id="color-stack"></div>
        <button class="btn-add" id="addColor">+ New Color</button>

        <div id="wave-only-ui">
            <h2>Physics & Motion</h2>
            <div class="control-group">
                <label>Wave Speed</label>
                <input type="range" id="waveSpeed" min="0" max="100" value="50">
            </div>
            <div class="control-group">
                <label>Fill Level</label>
                <input type="range" id="baseRange" min="10" max="90" value="65">
            </div>
            <div class="control-group">
                <label>Wave Intensity</label>
                <input type="range" id="waveIntensity" min="5" max="80" value="30">
            </div>
        </div>

        <div id="code-output"></div>
    </aside>

    <main id="viewport">
        <canvas id="mainCanvas"></canvas>
    </main>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const viewport = document.getElementById('viewport');
        const ctx = canvas.getContext('2d');
        const engineSelect = document.getElementById('engineMode');
        const presetSelect = document.getElementById('presetSelect');
        const colorStackContainer = document.getElementById('color-stack');
        const codeOut = document.getElementById('code-output');

        const presets = {
            lava: ['#ff4e50', '#f9d423', '#e73c7e'],
            ocean: ['#23a6d5', '#23d5ab', '#000428'],
            cyber: ['#6a11cb', '#2575fc', '#ff00ff']
        };

        const config = {
            mode: 'waves',
            colors: [...presets.lava],
            baseLevel: 0.65,
            intensity: 30,
            globalSpeed: 1.0,
            waveParticles: [],
            waveLayers: [
                { speedMult: 0.002, freq: 0.01, amp: 1.2, opacity: 1.0, glow: true },
                { speedMult: 0.001, freq: 0.015, amp: 0.8, opacity: 0.6, glow: false },
                { speedMult: 0.003, freq: 0.008, amp: 1.0, opacity: 0.3, glow: false }
            ]
        };

        let gridParticles = [];
        let waveYMap = [];
        let mouse = { x: null, y: null, radius: 120 };

        function applyPreset(name) {
            if (presets[name]) {
                config.colors = [...presets[name]];
                renderColorStack();
            }
        }

        function renderColorStack() {
            colorStackContainer.innerHTML = '';
            config.colors.forEach((col, i) => {
                const div = document.createElement('div');
                div.className = 'color-item';
                div.innerHTML = `<input type="color" value="${col}" data-i="${i}">
                    <span style="font-size:9px; flex-grow:1">${col}</span>
                    <button class="btn-remove" data-i="${i}">âœ•</button>`;
                colorStackContainer.appendChild(div);
            });
            updateVisuals();
        }

        colorStackContainer.addEventListener('input', (e) => {
            config.colors[e.target.dataset.i] = e.target.value;
            presetSelect.value = 'custom';
            updateVisuals();
        });

        colorStackContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-remove')) {
                config.colors.splice(e.target.dataset.i, 1);
                renderColorStack();
            }
        });

        document.getElementById('addColor').addEventListener('click', () => {
            config.colors.push('#ffffff');
            renderColorStack();
        });

        presetSelect.addEventListener('change', (e) => applyPreset(e.target.value));

        function updateVisuals() {
            document.documentElement.style.setProperty('--primary', config.colors[0]);
            if (config.mode === 'particles') {
                const grad = `linear-gradient(-45deg, ${config.colors.join(', ')})`;
                viewport.style.background = grad;
                viewport.style.backgroundSize = "400% 400%";
                viewport.style.animation = "lavaFlow 15s ease infinite";
                codeOut.innerText = `CSS Gradient:\nbackground: ${grad};`;
            } else {
                viewport.style.background = "#050505";
                viewport.style.animation = "none";
                codeOut.innerText = `Active Wave Color: ${config.colors[0]}\nFront Wave Opacity: 100%`;
            }
        }

        function spawnWaveParticles(x, y, count, force, gravity) {
            for (let i = 0; i < count; i++) {
                config.waveParticles.push({
                    x, y, vx: (Math.random() - 0.5) * force, vy: (Math.random() - 0.5) * force,
                    size: Math.random() * 4 + 2, life: 1.0, gravity: gravity ? 0.2 : 0.05,
                    color: config.colors[Math.floor(Math.random() * config.colors.length)]
                });
            }
        }

        function animate(time) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (config.mode === 'waves') {
                const baseY = canvas.height * (1 - config.baseLevel);
                
                // Draw layers from back to front
                for (let i = config.waveLayers.length - 1; i >= 0; i--) {
                    const layer = config.waveLayers[i];
                    ctx.beginPath();
                    ctx.moveTo(0, canvas.height);
                    
                    for (let x = 0; x <= canvas.width; x += 3) {
                        const y = baseY + (i * 15) + Math.sin(x * layer.freq + (time * layer.speedMult * config.globalSpeed)) * (config.intensity * layer.amp);
                        ctx.lineTo(x, y);
                        if (i === 0) waveYMap[x] = y;
                    }
                    
                    ctx.lineTo(canvas.width, canvas.height);
                    
                    const colorIdx = i % config.colors.length;
                    const mainColor = config.colors[colorIdx];
                    
                    // Front layer (i=0) is now fully opaque
                    ctx.globalAlpha = (i === 0) ? 1.0 : layer.opacity;
                    
                    // Glow effect only for the front wave
                    if (i === 0) {
                        ctx.shadowBlur = 15;
                        ctx.shadowColor = mainColor;
                    } else {
                        ctx.shadowBlur = 0;
                    }

                    const grad = ctx.createLinearGradient(0, baseY - 50, 0, canvas.height);
                    grad.addColorStop(0, mainColor);
                    grad.addColorStop(1, '#000000');
                    
                    ctx.fillStyle = grad;
                    ctx.fill();
                    ctx.shadowBlur = 0; // Reset for next layers
                }

                config.waveParticles.forEach((p, i) => {
                    p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.life -= 0.015;
                    ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                    if (p.life <= 0) config.waveParticles.splice(i, 1);
                });
            } else {
                // Particle Mode
                gridParticles.forEach(p => {
                    let dx = mouse.x - p.x; let dy = mouse.y - p.y;
                    let dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < mouse.radius) {
                        let f = (mouse.radius - dist) / mouse.radius;
                        p.x -= (dx/dist) * f * p.den; p.y -= (dy/dist) * f * p.den;
                    } else {
                        p.x -= (p.x - p.bx) / 10; p.y -= (p.y - p.by) / 10;
                    }
                    ctx.fillStyle = 'rgba(255,255,255,0.8)';
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.sz, 0, Math.PI*2); ctx.fill();
                });
            }
            ctx.globalAlpha = 1;
            requestAnimationFrame(animate);
        }

        function initGrid() {
            gridParticles = [];
            for(let y=0; y<canvas.height; y+=25) for(let x=0; x<canvas.width; x+=25) 
                gridParticles.push({x, y, bx:x, by:y, sz:Math.random()*3+1, den:Math.random()*25+1});
        }

        viewport.addEventListener('mousemove', (e) => {
            mouse.x = e.offsetX; mouse.y = e.offsetY;
            if (config.mode === 'waves' && Math.random() > 0.8) {
                const r = document.createElement('div');
                r.className = 'ripple'; r.style.left = (mouse.x-25)+'px'; r.style.top = (mouse.y-25)+'px';
                viewport.appendChild(r); setTimeout(()=>r.remove(), 1000);
            }
        });

        viewport.addEventListener('mousedown', () => {
            mouse.radius = 250; setTimeout(()=>mouse.radius=120, 200);
            if(config.mode === 'waves') {
                const wy = waveYMap[Math.floor(mouse.x)] || canvas.height/2;
                spawnWaveParticles(mouse.x, mouse.y, 35, 10, mouse.y < wy);
            }
        });

        engineSelect.addEventListener('change', (e) => {
            config.mode = e.target.value;
            if (config.mode === 'particles') initGrid();
            updateVisuals();
        });

        document.getElementById('waveSpeed').addEventListener('input', e => config.globalSpeed = e.target.value / 50);
        document.getElementById('baseRange').addEventListener('input', e => config.baseLevel = e.target.value/100);
        document.getElementById('waveIntensity').addEventListener('input', e => config.intensity = e.target.value);
        window.addEventListener('resize', () => { canvas.width = viewport.clientWidth; canvas.height = viewport.clientHeight; if(config.mode==='particles') initGrid(); });

        renderColorStack();
        window.dispatchEvent(new Event('resize'));
        animate(0);
    </script>
</body>
</html>